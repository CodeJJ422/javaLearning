# 2025-10-08 学習記録

## 📘 学んだこと
- エンティティ
- コンストラクタ
- Lombok
- データベースの作成方法
- テーブルの作成方法
- リポジトリ
- データベースの作成から取得までの流れのまとめ

## エンティティ
データベースと連携する際にデータを格納するためのオブジェクト。
エンティティにはテーブルの各カラムに対応した変数を用意する。

```java
public class PostEntity {
   private long id;
   private String memo;
}
```

また、以下の設定が必要
- コンストラクタ
- ゲッターとセッター

## コンストラクタ
オブジェクトを作るときに最初に呼ばれるメソッドで、エンティティに初期値を入れるための仕組みのこと。

```java
// コンストラクタ（初期値をセットする）
    public PostEntity(long id, String memo) {
       this.id = id;
       this.memo = memo;
   }
```

こうすることで、新しくオブジェクトを作成する時に同時に値をセットすることができる。

## Lombok
コンストラクタやゲッターセッターの生成を自動で行うプラグイン。

```
import lombok.AllArgsConstructor;
import lombok.Data;

@AllArgsConstructor
@Data
public class PostEntity {
   private long id;
   private String memo;
}
```

- @AllArgsConstructorはコンストラクタの自動生成
- @Dataはゲッターセッターの自動生成

これらのアノテーションを使用することでエンティティの記述を簡単にできる。

## データベースの作成方法
ターミナルを開いて
```
mysql -u root
```
```
mysql> create database ○○;
```
```
mysql> exit;
```

## テーブルの作成方法
resourcesフォルダの直下に「schema.sql」を作成

```
CREATE TABLE IF NOT EXISTS posts (
    id BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    memo VARCHAR(256) NOT NULL
);
```

解説

```CREATE TABLE IF NOT EXISTS posts```

```CREATE TABLE``` → 新しいテーブルを作る命令

```IF NOT EXISTS``` → 同名のテーブルがすでに存在する場合は作らない

```posts``` → テーブル名（ここでは「投稿」や「メモ」を格納するテーブル）

💡 この書き方をすると、誤ってテーブルを二重作成するのを防げる。

```id BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT```

```id``` → カラム名（主キーとなる列）

```BIGINT``` → データ型（大きい整数型）

```NOT NULL``` → NULL（空の値）は許さない

```PRIMARY KEY``` → 主キー（テーブル内でユニーク、重複不可）

```AUTO_INCREMENT``` → 新しいレコードを追加するたびに自動で 1 ずつ増える値

💡 つまり、この id は 一意な識別子 になる。

```memo VARCHAR(256) NOT NULL```

```memo``` → カラム名（メモの内容を格納）

```VARCHAR(256)``` → 最大256文字の可変長文字列

```NOT NULL``` → 空（NULL）は許さない

💡 この列には必ず文字列が入る必要がある。

## リポジトリ
SQLの操作をJavaのメソッドとして定義するためのもの。
「インターフェース」に記述される。インターフェースはクラスの元のようなものである。
- MyBatisを使用した記述例
```java
package com.example.demo.mapper;

import com.example.demo.entity.User;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Select;
import org.apache.ibatis.annotations.Insert;
import org.apache.ibatis.annotations.Delete;
import org.apache.ibatis.annotations.Update;

import java.util.List;

@Mapper  // これを付けるとSpringがここに定義されているメソッドの実装はSQLであると認識する。
public interface UserMapper {

    // 全件取得
    @Select("SELECT * FROM users")
    List<User> findAll();

    // IDで取得
    @Select("SELECT * FROM users WHERE id = #{id}")
    User findById(Long id);

    // 新規登録
    @Insert("INSERT INTO users(name, email) VALUES(#{name}, #{email})")
    void insert(User user);

    // 更新
    @Update("UPDATE users SET name = #{name}, email = #{email} WHERE id = #{id}")
    void update(User user);

    // 削除
    @Delete("DELETE FROM users WHERE id = #{id}")
    void delete(Long id);
}
```

## データベースの作成から取得までの流れのまとめ

1. データベースを作る（MySQLなど）
   
2. エンティティ（テーブルに対応するクラス）を作る
   
3. リポジトリを作る
   
4. コントローラでデータベースからデータを取得する
   
5. Modelを通してビューにデータを渡す